create table bar_1m_fill with(kafka_topic='bar_1m_fill', key_format='avro', value_format='avro')as select h.key->broker as broker, h.key->symbol as symbol, h.key->bucketstart as bucketstart, h.bucketstart as bucketstart, coalesce(l.open, cast(p.open)as decimal(18, 4))as open, coalesce(l.high, cast(p.high)as decimal(18, 4))as high, coalesce(l.low, cast(p.low)as decimal(18, 4))as low, coalesce(l.close, p.close)as close from bar_hb_1m h left join bar_1m_final l on h.key->broker = l.key->broker and h.key->symbol = l.key->symbol and h.key->bucketstart = l.key->bucketstart and h.bucketstart = l.bucketstart left join bar_prev_1m p on h.key->broker = p.key->broker and h.key->symbol = p.key->symbol and h.key->bucketstart = p.key->bucketstart and h.bucketstart = p.bucketstart emit changes;